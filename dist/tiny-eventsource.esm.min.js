/*!
 2022 Jason Mulligan <jason.mulligan@avoidwork.com>
 @version 2.0.0
*/
import{EventEmitter as t}from"node:events";function e(t){t.heartbeat.ms>0&&setTimeout((()=>{t.listenerCount("data")>0&&(t.send(t.heartbeat.msg,t.heartbeat.event),e(t))}),t.heartbeat.ms)}class s extends t{constructor(t,...e){const s="string"==typeof t,n=!s&&void 0!==t&&t instanceof Object;super(),this.heartbeat={event:n&&"string"==typeof t.event?t.event:"message",ms:n&&"number"==typeof t.ms?t.ms:0,msg:n&&"string"==typeof t.msg?t.msg:"ping"},this.initial=s?[t,...e]:[...e],this.setMaxListeners(0)}init(t,s){let n=-1;const i=t=>function(t,e,s){t.write(`id: ${e.id||s}\n`),void 0!==e.event&&t.write(`event: ${e.event}\n`),t.write(`data: ${"object"==typeof e.data?JSON.stringify(e.data):e.data}\n\n`)}(s,t,++n);return void 0!==t&&(t.socket.setTimeout(0),t.socket.setNoDelay(!0),t.socket.setKeepAlive(!0),t.on("close",(()=>this.off("data",i)))),void 0!==s&&(s.statusCode=200,s.setHeader("content-type","text/event-stream"),s.setHeader("cache-control","no-store, max-age=0"),s.setHeader("connection","keep-alive"),this.on("data",i)),this.initial.forEach((t=>this.send(t))),this.heartbeat.ms>0&&e(this),this}send(t,e,s){return this.emit("data",{data:t,event:e,id:s}),this}}function n(...t){return new s(...t)}export{n as eventsource};//# sourceMappingURL=tiny-eventsource.esm.min.js.map
